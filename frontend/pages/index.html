<!DOCTYPE html> <!-- Declara documento HTML5 -->
<html lang="pt-BR"> <!-- Tag HTML com idioma portuguﾃｪs Brasil -->
<head> <!-- Cabeﾃｧalho com metadados -->
    <meta charset="UTF-8"> <!-- Codificaﾃｧﾃ｣o UTF-8 para caracteres especiais -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsividade mobile -->
    <title>Dashboard - Sistema Escolar</title> <!-- Tﾃｭtulo da aba do navegador -->
    <link rel="stylesheet" href="../assets/css/style.css"> <!-- Importa CSS personalizado -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Importa biblioteca Chart.js via CDN para criar grﾃ｡ficos -->
</head> <!-- Fecha head -->
<body> <!-- Inﾃｭcio do corpo do documento (conteﾃｺdo visﾃｭvel) -->
    <header class="header"> <!-- Tag header com classe header (CSS define estilo) -->
        <div class="header-content"> <!-- Div para conteﾃｺdo interno do header -->
            <h1>Sistema Escolar</h1> <!-- Tﾃｭtulo principal (h1 = heading 1, maior tamanho) -->
            <button class="mobile-menu-btn" onclick="toggleMenu()">笘ｰ</button> <!-- Botﾃ｣o menu mobile (ﾃｭcone hambﾃｺrguer) onclick chama toggleMenu() -->
            <nav> <!-- Tag nav para navegaﾃｧﾃ｣o -->
                <ul class="nav-menu" id="navMenu"> <!-- Lista nﾃ｣o ordenada com classe nav-menu e id navMenu -->
                    <li><a href="/dashboard" class="active">Inﾃｭcio</a></li> <!-- Item de lista com link ativo (pﾃ｡gina atual) -->
                    <li><a href="/usuarios">Usuﾃ｡rios</a></li> <!-- Link para usuﾃ｡rios -->
                    <li><a href="/alunos">Alunos</a></li> <!-- Link para alunos -->
                    <li><a href="/professores">Professores</a></li> <!-- Link para professores -->
                    <li><a href="#" onclick="logout()" style="color: var(--error);">Sair</a></li> <!-- Link sair com cor vermelha (var(--error) = variﾃ｡vel CSS) -->
                </ul> <!-- Fecha lista -->
            </nav> <!-- Fecha nav -->
        </div> <!-- Fecha header-content -->
    </header> <!-- Fecha header -->

    <main class="main-content"> <!-- Tag main com classe main-content (conteﾃｺdo principal) -->
        <div class="card fade-in"> <!-- Div card com animaﾃｧﾃ｣o fade-in (CSS define entrada suave) -->
            <div class="card-header"> <!-- Div cabeﾃｧalho do card -->
                <h2 class="card-title">Bem-vindo ao Sistema Escolar</h2> <!-- Tﾃｭtulo h2 com classe card-title -->
            </div> <!-- Fecha card-header -->
            <p class="text-secondary">Gerencie alunos, professores e usuﾃ｡rios de forma simples e eficiente.</p> <!-- Parﾃ｡grafo com texto secundﾃ｡rio (cor cinza) -->
            <div class="mt-10"> <!-- Div com margem superior 10px (mt = margin-top) -->
                <span id="usuarioNome" class="text-primary" style="font-weight: 600; font-size: 1.1rem;"></span> <!-- Span com id usuarioNome (JS coloca nome), cor primﾃ｡ria, negrito 600, tamanho 1.1rem -->
            </div> <!-- Fecha mt-10 -->
        </div> <!-- Fecha card -->

        <div class="dashboard-cards"> <!-- Div com classe dashboard-cards (CSS cria grid de cards) -->
            <div class="stat-card fade-in"> <!-- Primeiro card de estatﾃｭstica com animaﾃｧﾃ｣o -->
                <div class="stat-number" id="totalAlunos">0</div> <!-- Div com nﾃｺmero grande, id totalAlunos (JS atualiza) -->
                <div class="stat-label">Total de Alunos</div> <!-- Div com rﾃｳtulo/descriﾃｧﾃ｣o -->
            </div> <!-- Fecha stat-card -->
            
            <div class="stat-card success fade-in"> <!-- Segundo card com classe success (cor verde) -->
                <div class="stat-number" id="totalProfessores">0</div> <!-- Nﾃｺmero de professores -->
                <div class="stat-label">Total de Professores</div> <!-- Rﾃｳtulo -->
            </div> <!-- Fecha stat-card -->
            
            <div class="stat-card warning fade-in"> <!-- Terceiro card com classe warning (cor laranja/amarela) -->
                <div class="stat-number" id="totalUsuarios">0</div> <!-- Nﾃｺmero de usuﾃ｡rios -->
                <div class="stat-label">Total de Usuﾃ｡rios</div> <!-- Rﾃｳtulo -->
            </div> <!-- Fecha stat-card -->
        </div> <!-- Fecha dashboard-cards -->

        <div class="chart-container fade-in"> <!-- Div container do grﾃ｡fico com animaﾃｧﾃ｣o fade-in -->
            <h3 class="card-title mb-20">Visﾃ｣o Geral</h3> <!-- Tﾃｭtulo h3 com margem inferior 20px (mb = margin-bottom) -->
            <canvas id="graficoGeral" class="chart-canvas"></canvas> <!-- Canvas (elemento HTML5 para desenhar) com id graficoGeral e classe chart-canvas -->
        </div> <!-- Fecha chart-container -->

        <div class="card fade-in"> <!-- Card de aﾃｧﾃｵes rﾃ｡pidas com animaﾃｧﾃ｣o -->
            <div class="card-header"> <!-- Cabeﾃｧalho do card -->
                <h3 class="card-title">Aﾃｧﾃｵes Rﾃ｡pidas</h3> <!-- Tﾃｭtulo -->
            </div> <!-- Fecha card-header -->
            <div class="flex gap-10"> <!-- Div flex (exibe filhos em linha) com gap 10px (espaﾃｧamento entre elementos) -->
                <a href="/usuarios" class="btn btn-primary"> <!-- Link com estilo de botﾃ｣o primﾃ｡rio -->
                    側 Gerenciar Usuﾃ｡rios <!-- Emoji + texto -->
                </a> <!-- Fecha link -->
                <a href="/alunos" class="btn btn-success"> <!-- Link com estilo de botﾃ｣o success (verde) -->
                    雌 Gerenciar Alunos <!-- Emoji + texto -->
                </a> <!-- Fecha link -->
                <a href="/professores" class="btn btn-secondary"> <!-- Link com estilo de botﾃ｣o secundﾃ｡rio (cinza) -->
                    捉窶昨沛ｫ Gerenciar Professores <!-- Emoji + texto -->
                </a> <!-- Fecha link -->
            </div> <!-- Fecha flex -->
        </div> <!-- Fecha card -->
    </main> <!-- Fecha main-content -->

    <footer class="footer"> <!-- Tag footer com classe footer (rodapﾃｩ) -->
        <div class="footer-frame"> <!-- Div footer-frame (CSS define estilo) -->
            ﾂｩ Valdemar Sistemas - 2025 <!-- Texto copyright com sﾃｭmbolo ﾂｩ -->
        </div> <!-- Fecha footer-frame -->
    </footer> <!-- Fecha footer -->

    <script> <!-- Inﾃｭcio do JavaScript inline (dentro do HTML) -->
        // Configuraﾃｧﾃ｣o da API: pega origem do site atual e adiciona /api
        // Exemplo: http://localhost:3000/api ou https://seusite.com/api
        const API_BASE = window.location.origin + '/api'; // Cria URL base da API dinamicamente

        // FUNﾃﾃグ: Verificar se usuﾃ｡rio estﾃ｡ logado
        function verificarAuth() { // Define funﾃｧﾃ｣o verificarAuth
            const usuario = localStorage.getItem('usuario'); // Busca dados do usuﾃ｡rio no localStorage do navegador
            if (!usuario) { // Se nﾃ｣o encontrou (nﾃ｣o estﾃ｡ logado)
                window.location.href = 'login.html'; // Redireciona para pﾃ｡gina de login
                return null; // Retorna nulo
            } // Fecha if
            return JSON.parse(usuario); // Se estﾃ｡ logado, converte JSON string em objeto e retorna
        } // Fecha funﾃｧﾃ｣o

        // FUNﾃﾃグ: Fazer logout do sistema
        function logout() { // Define funﾃｧﾃ｣o logout
            localStorage.removeItem('usuario'); // Remove dados do usuﾃ｡rio do localStorage (desloga)
            window.location.href = 'login.html'; // Redireciona para tela de login
        } // Fecha funﾃｧﾃ｣o

        // FUNﾃﾃグ: Abrir/fechar menu mobile (responsivo)
        function toggleMenu() { // Define funﾃｧﾃ｣o toggleMenu
            const navMenu = document.getElementById('navMenu'); // Pega elemento com id navMenu
            navMenu.classList.toggle('show'); // Adiciona/remove classe 'show' (CSS mostra/esconde menu)
        } // Fecha funﾃｧﾃ｣o

        // FUNﾃﾃグ: Carregar estatﾃｭsticas do dashboard (total alunos, professores, usuﾃ｡rios)
        async function carregarEstatisticas() { // Define funﾃｧﾃ｣o async (permite usar await)
            try { // Bloco try para capturar erros
                const response = await fetch(`${API_BASE}/dashboard`); // Faz requisiﾃｧﾃ｣o GET para /api/dashboard
                const data = await response.json(); // Converte resposta em objeto JavaScript

                if (data.success) { // Se a API retornou sucesso
                    document.getElementById('totalAlunos').textContent = data.data.totalAlunos; // Atualiza nﾃｺmero de alunos na tela
                    document.getElementById('totalProfessores').textContent = data.data.totalProfessores; // Atualiza nﾃｺmero de professores
                    document.getElementById('totalUsuarios').textContent = data.data.totalUsuarios; // Atualiza nﾃｺmero de usuﾃ｡rios

                    // Criar grﾃ｡fico com os dados recebidos
                    criarGrafico(data.data); // Chama funﾃｧﾃ｣o que cria o grﾃ｡fico passando os dados
                } else { // Se API retornou erro (success = false)
                    console.error('Erro ao carregar estatﾃｭsticas:', data.message); // Exibe erro no console do navegador
                } // Fecha else
            } catch (error) { // Bloco catch captura erros de rede/conexﾃ｣o
                console.error('Erro de conexﾃ｣o:', error); // Exibe erro no console
            } // Fecha catch
        } // Fecha funﾃｧﾃ｣o

        // FUNﾃﾃグ: Criar grﾃ｡fico de rosca (doughnut) usando Chart.js
        function criarGrafico(dados) { // Define funﾃｧﾃ｣o que recebe os dados como parﾃ｢metro
            const ctx = document.getElementById('graficoGeral').getContext('2d'); // Pega elemento canvas e seu contexto 2D para desenhar
            
            new Chart(ctx, { // Cria nova instﾃ｢ncia do Chart.js no canvas
                type: 'doughnut', // Tipo: grﾃ｡fico de rosca (cﾃｭrculo com buraco no meio)
                data: { // Objeto com os dados do grﾃ｡fico
                    labels: ['Alunos', 'Professores', 'Usuﾃ｡rios'], // Array com rﾃｳtulos das fatias
                    datasets: [{ // Array de conjuntos de dados (sﾃｳ 1 neste caso)
                        data: [dados.totalAlunos, dados.totalProfessores, dados.totalUsuarios], // Array com valores numﾃｩricos das fatias
                        backgroundColor: [ // Array com cores de fundo de cada fatia
                            '#3B82F6', // Azul para alunos (cor hexadecimal)
                            '#10B981', // Verde para professores
                            '#F59E0B'  // Laranja/amarelo para usuﾃ｡rios
                        ], // Fecha backgroundColor
                        borderColor: [ // Array com cores de borda de cada fatia
                            '#2563EB', // Azul escuro (borda dos alunos)
                            '#059669', // Verde escuro (borda dos professores)
                            '#D97706'  // Laranja escuro (borda dos usuﾃ｡rios)
                        ], // Fecha borderColor
                        borderWidth: 2 // Largura da borda em pixels
                    }] // Fecha datasets
                }, // Fecha data
                options: { // Objeto com configuraﾃｧﾃｵes/opﾃｧﾃｵes do grﾃ｡fico
                    responsive: true, // Grﾃ｡fico se adapta ao tamanho da tela (responsivo)
                    maintainAspectRatio: false, // Nﾃ｣o mantﾃｩm proporﾃｧﾃ｣o (permite altura customizada)
                    plugins: { // Objeto com plugins (extensﾃｵes) do Chart.js
                        title: {
                            display: true,
                            text: 'Distribuiﾃｧﾃ｣o por Categoria',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }, // Fecha title
                        legend: { // Configuraﾃｧﾃｵes da legenda (quadradinhos com cores e rﾃｳtulos)
                            position: 'bottom', // Posiﾃｧﾃ｣o da legenda: embaixo do grﾃ｡fico
                            labels: { // Configuraﾃｧﾃｵes dos rﾃｳtulos da legenda
                                padding: 20, // Espaﾃｧamento de 20px ao redor
                                usePointStyle: true, // Usar cﾃｭrculos em vez de quadrados
                                font: { // Fonte dos rﾃｳtulos
                                    size: 12 // Tamanho 12 pixels
                                } // Fecha font
                            } // Fecha labels
                        } // Fecha legend
                    } // Fecha plugins
                } // Fecha options
            }); // Fecha new Chart
        } // Fecha funﾃｧﾃ｣o criarGrafico

        // INICIALIZAﾃﾃグ: Executa quando a pﾃ｡gina termina de carregar
        document.addEventListener('DOMContentLoaded', () => { // Escuta evento DOMContentLoaded (quando HTML estﾃ｡ pronto)
            const usuario = verificarAuth(); // Verifica se estﾃ｡ logado e pega dados do usuﾃ｡rio
            if (usuario) { // Se usuﾃ｡rio estﾃ｡ logado
                document.getElementById('usuarioNome').textContent = `Olﾃ｡, ${usuario.nome}!`; // Mostra "Olﾃ｡, [Nome]!" na tela
                carregarEstatisticas(); // Carrega os nﾃｺmeros e cria grﾃ｡fico
            } // Fecha if

            // ANIMAﾃﾃ髭S: Aplicar efeito fade-in nos elementos
            const elements = document.querySelectorAll('.fade-in'); // Seleciona todos elementos com classe fade-in
            elements.forEach((el, index) => { // Loop forEach: para cada elemento (el) e seu ﾃｭndice (index)
                setTimeout(() => { // setTimeout: executa funﾃｧﾃ｣o apﾃｳs delay
                    el.style.animation = `fadeIn 0.5s ease-out forwards`; // Define animaﾃｧﾃ｣o CSS: fadeIn por 0.5seg
                }, index * 100); // Delay = ﾃｭndice * 100ms (cada elemento aparece 100ms depois do anterior)
            }); // Fecha forEach
        }); // Fecha addEventListener

        // FECHAR MENU MOBILE: Fecha menu ao clicar fora dele
        document.addEventListener('click', (e) => { // Escuta cliques em qualquer lugar do documento
            const navMenu = document.getElementById('navMenu'); // Pega elemento do menu
            const menuBtn = document.querySelector('.mobile-menu-btn'); // Pega botﾃ｣o do menu (querySelector = 1ﾂｺ elemento que corresponde ao seletor CSS)
            
            if (!navMenu.contains(e.target) && !menuBtn.contains(e.target)) { // Se clique Nﾃグ foi dentro do menu E Nﾃグ foi no botﾃ｣o
                navMenu.classList.remove('show'); // Remove classe 'show' (fecha menu)
            } // Fecha if
        }); // Fecha addEventListener

        // AUTO-REFRESH: Atualizar estatﾃｭsticas automaticamente a cada 30 segundos
        setInterval(carregarEstatisticas, 30000); // setInterval executa funﾃｧﾃ｣o repetidamente (30000ms = 30seg)
    </script> <!-- Fecha script -->
</body> <!-- Fecha body -->
</html> <!-- Fecha HTML -->